# Arabic Voice Agent

A FastAPI-based backend server for the Arabic Voice Agent application.

## Features

- RESTful API endpoints for session management
- **Pipecat-powered real-time voice pipelines** for low-latency speech interactions
- WebSocket support for real-time agent interactions (legacy and Pipecat endpoints)
- Content management and delivery
- Webhook integration
- CORS support for web clients
- Environment-based configuration
- Comprehensive API documentation (auto-generated by FastAPI)

## Voice Pipeline Architecture

The web-api now uses [Pipecat](https://github.com/pipecat-ai/pipecat), an open-source framework for building voice and multimodal conversational AI. Pipecat orchestrates the complete voice pipeline:

**Pipeline Flow:**
```
Client Audio → WebSocket → Deepgram STT → OpenAI LLM → ElevenLabs TTS → WebSocket → Client
```

**Key Components:**
- **Transport**: FastAPI WebSocket with Pipecat's native audio handling
- **STT**: Deepgram for real-time speech recognition (supports Arabic)
- **LLM**: OpenAI GPT-4o for natural language processing
- **TTS**: ElevenLabs Multilingual v2 for voice synthesis
- **VAD**: Silero Voice Activity Detection for turn management

**Endpoints:**
- **New (Pipecat)**: `/pipecat/session/{session_id}` - Real-time voice pipeline
- **Legacy**: `/realtime-session/{session_id}` - Custom WebSocket with Soniox async STT

## Setup

This project uses [uv](https://docs.astral.sh/uv/) for dependency management and [Task](https://taskfile.dev/) for task automation.

### 1. Install Dependencies

```bash
cd web-api
task install
# or manually: uv sync
```

### 2. Configure Environment Variables

Create a `.env` file based on `.env.example`:

```bash
cp .env.example .env
```

Edit `.env` and add your configuration:

**Required for Pipecat endpoints:**
- `OPENAI_API_KEY` - OpenAI API key for GPT-4o
- `DEEPGRAM_API_KEY` - Deepgram API key for real-time STT
- `ELEVEN_API_KEY` - ElevenLabs API key for TTS
- `SUPABASE_URL` and `SUPABASE_SECRET_KEY` - Supabase configuration

**Optional (for legacy endpoints):**
- `SONIOX_API_KEY` - Soniox API key for async STT
- `WEBHOOK_BASE_URL` - Base URL for webhook callbacks

### 3. Run the Server

Using Task (recommended):

```bash
task dev     # Development mode with hot reload
task start   # Production mode
```

Or using uv directly:

```bash
uv run uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

The server will start on `http://localhost:8000`

## API Endpoints

### Root Endpoint

```
GET /
```

Returns the service status.

### Health Check

```
GET /health
```

Returns detailed health status.

## Interactive API Documentation

FastAPI provides automatic interactive documentation:

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Security Considerations

1. **CORS Configuration**: Update the `allow_origins` in `main.py` to restrict access to specific domains in production:
   ```python
   allow_origins=["https://your-frontend-domain.com"]
   ```

2. **Environment Variables**: Never commit `.env` files with real credentials to version control.

3. **HTTPS**: Use HTTPS in production. Configure a reverse proxy (nginx, Caddy) or deploy behind a load balancer.

4. **Rate Limiting**: Consider adding rate limiting to prevent abuse of the API endpoints.

5. **Authentication**: Add authentication/authorization to endpoints to verify that requesters are authorized users.

## Development

### Available Tasks

```bash
task install  # Install dependencies
task dev      # Run development server with hot reload
task start    # Run production server
task clean    # Clean up generated files
```

### Testing

Test the health endpoint using curl:

```bash
# Health check
curl http://localhost:8000/health
```

## License

This project follows the same license as the parent repository.
