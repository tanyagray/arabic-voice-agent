version: '3'

tasks:
  install:
    desc: Install dependencies using uv
    cmds:
      - uv sync

  dev:
    desc: Run the FastAPI server in development mode with hot reload
    deps: [install]
    cmds:
      - uv run python -m debugpy --listen 5678 -m uvicorn main:app --reload --host 0.0.0.0 --port 8000

  start:
    desc: Run the FastAPI server in production mode
    deps: [install]
    cmds:
      - uv run uvicorn main:app --host 0.0.0.0 --port 8000

  test:
    desc: Run unit tests with pytest
    deps: [install]
    cmds:
      - uv run pytest

  test:watch:
    desc: Run unit tests in watch mode
    deps: [install]
    cmds:
      - uv run pytest-watch

  health-check:
    desc: Test the API health endpoint
    cmds:
      - |
        echo "Testing /health endpoint..."
        curl -s http://localhost:8000/health | jq .

  clean:
    desc: Clean up generated files and cache
    cmds:
      - rm -rf __pycache__
      - rm -rf .pytest_cache
      - find . -type f -name "*.pyc" -delete
      - find . -type d -name "__pycache__" -delete
